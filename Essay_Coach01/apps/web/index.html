Below is a minimal, working thin-slice you can paste into your repo. It renders the UI, supports `?lang=es`, and calls either a mock (no network, via `?dev=1`) or a real API at `API_BASE` (override with `?api=https://...`).

---

## apps/web/index.html

```html
<!doctype html>
<html data-theme="coral" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EssayCoach – Cambridge Toolkit</title>
  <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/style.css">
  <script>
    // Locale detection (query param → path prefix /es/ → default en)
    (function(){
      const qs=new URLSearchParams(location.search); const qp=qs.get('lang');
      const pathIsEs=location.pathname.replace(/\/+$/,'').endsWith('/es')||location.pathname.includes('/es/');
      const lang= (qp||'').match(/^(en|es)$/)?qp:(pathIsEs?'es':'en');
      document.documentElement.setAttribute('lang', lang);
      window.__EC_LANG=lang;
    })();
  </script>
  <script defer src="./js/i18n.js"></script>
  <script defer src="./js/config.js"></script>
  <script defer src="./js/ec_sentences.js"></script>
  <script defer src="./js/app.js"></script>
  <style>
    body{font-family:Inter,system-ui,Arial,sans-serif; margin:0;}
    header,footer{padding:12px 16px}
    .container{max-width:1000px;margin:0 auto;padding:16px}
    textarea{width:100%;min-height:220px;padding:12px;font-size:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #bbb}
    .pill.ok{background:#e7f7ea;border-color:#58a869}
    .pill.warn{background:#fff6e6;border-color:#d08b39}
    .btn{padding:8px 12px;border:1px solid #222;border-radius:10px;background:#111;color:#fff;cursor:pointer}
    .btn.ghost{background:#fff;color:#111;border-color:#aaa}
    .panel{border:1px solid #ddd;border-radius:12px;padding:12px}
    .muted{color:#666}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<header class="row">
  <strong>EssayCoach</strong>
  <span class="muted" id="devBanner" style="display:none">DEV MODE</span>
  <span style="margin-left:auto">
    <select id="level">
      <option value="B2">B2</option>
      <option value="C1" selected>C1</option>
      <option value="C2">C2</option>
    </select>
  </span>
</header>

<main class="container">
  <div class="grid">
    <section class="panel">
      <h3 data-i18n="labels.prompt">Task prompt</h3>
      <textarea id="task" placeholder="Paste the exam task here..."></textarea>
      <h3 data-i18n="labels.essay">Your essay</h3>
      <textarea id="essay" placeholder="Paste or write your essay here..."></textarea>
      <div class="row" style="align-items:center;justify-content:space-between">
        <div class="row">
          <span class="pill" id="inWC">Input: 0 words</span>
          <span class="pill" id="outWC">Output: 0 words</span>
          <span class="pill" id="p2TargetWC">—</span>
        </div>
        <div class="row">
          <button class="btn" id="btnCorrect" data-i18n="buttons.correct">Correct</button>
          <button class="btn ghost" id="btnClear" data-i18n="buttons.clear">Clear</button>
        </div>
      </div>
    </section>

    <section class="panel">
      <h3 data-i18n="labels.feedback">Feedback</h3>
      <div id="scores" class="muted">—</div>
      <h4>Edits</h4>
      <ol id="edits"></ol>
      <h4>Next draft</h4>
      <ul id="next"></ul>
    </section>
  </div>
</main>

<footer class="container muted">
  <small>API: <span id="apiInfo">(auto)</span></small>
</footer>
</body>
</html>
```

---

## apps/web/js/config.js

```js
window.EC_CONFIG = {
  API_BASE: "https://YOUR_WORKER_SUBDOMAIN.workers.dev", // override with ?api=https://...
  VERSION: "2025.10.18"
};
```

---

## apps/web/js/i18n.js

```js
async function loadI18n(lang){
  const res = await fetch(`./assets/i18n/${lang}.json`);
  if(!res.ok) throw new Error('i18n load failed');
  return res.json();
}
function applyI18n(dict){
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key=el.getAttribute('data-i18n');
    if(dict[key]) el.textContent = dict[key];
  });
}
```

---

## apps/web/assets/i18n/en.json

```json
{
  "labels.prompt": "Task prompt",
  "labels.essay": "Your essay",
  "labels.feedback": "Feedback",
  "buttons.correct": "Correct",
  "buttons.clear": "Clear",
  "io.input_words": "Input: {n} words",
  "io.output_words": "Output: {n} words"
}
```

## apps/web/assets/i18n/es.json

```json
{
  "labels.prompt": "Consigna",
  "labels.essay": "Tu redacción",
  "labels.feedback": "Retroalimentación",
  "buttons.correct": "Corregir",
  "buttons.clear": "Borrar",
  "io.input_words": "Entrada: {n} palabras",
  "io.output_words": "Salida: {n} palabras"
}
```

---

## apps/web/js/ec_sentences.js (tiny helpers)

```js
function wordCount(s){ return (s||'').trim().split(/\s+/).filter(Boolean).length; }
function p2TargetForLevel(lvl){
  const map={B2:{min:140,max:190,label:'B2: 140–190'}, C1:{min:220,max:260,label:'C1: 220–260'}, C2:{min:240,max:280,label:'C2: 240–280'}};
  return map[lvl]||map.C1;
}
```

---

## apps/web/js/app.js

```js
if (window.__EC_APP_LOADED) { throw new Error('app.js loaded twice'); }
window.__EC_APP_LOADED = true;

(function(){
  const qs = new URLSearchParams(location.search);
  const apiOverride = qs.get('api');
  const dev = qs.get('dev')==='1';
  if (apiOverride) {
    const base = String(apiOverride).replace(/\/+$/,'');
    window.EC_CONFIG.API_BASE = base;
  }
  document.getElementById('apiInfo').textContent = (dev? 'DEV (mock)' : EC_CONFIG.API_BASE);
  if(dev){ const b=document.getElementById('devBanner'); if(b) b.style.display='inline-block'; }

  const lang = window.__EC_LANG||'en';
  loadI18n(lang).then(applyI18n).catch(console.error);

  const lvlEl = document.getElementById('level');
  const taskEl = document.getElementById('task');
  const essayEl = document.getElementById('essay');
  const inEl = document.getElementById('inWC');
  const outEl = document.getElementById('outWC');
  const targetEl = document.getElementById('p2TargetWC');
  function updateCounts(){
    const wc = wordCount(essayEl.value);
    const inLabel  = (window.__i18n?.[lang]?.['io.input_words']||'Input: {n} words').replace('{n}', wc);
    inEl.textContent = inLabel;
    targetEl.textContent = p2TargetForLevel(lvlEl.value).label;
  }
  essayEl.addEventListener('input', updateCounts); updateCounts();

  document.getElementById('btnClear').addEventListener('click', ()=>{ essayEl.value=''; updateCounts(); });
  document.getElementById('btnCorrect').addEventListener('click', async ()=>{
    const payload = {
      level: lvlEl.value,
      taskType: 'essay',
      taskPrompt: taskEl.value||'',
      studentText: essayEl.value||'',
      targetWordCount: p2TargetForLevel(lvlEl.value).max-10,
      language: 'en',
      options: { strictCambridge:true, minChangeEdits:true, highlightPunctuationJoins:true, returnInlineDiff:true },
      client: { appVersion: EC_CONFIG.VERSION, dev }
    };

    let data;
    if (dev) { data = mockCorrect(payload); }
    else {
      const res = await fetch(`${EC_CONFIG.API_BASE}/api/correct`, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
      if(!res.ok) { alert('API error'); return; }
      data = await res.json();
    }
    renderResult(data);
  });

  function renderResult(d){
    // scores
    const s = d.scores||{};
    document.getElementById('scores').innerHTML = `
      Content: <b>${s.content?.band??'-'}</b> · CA: <b>${s.communicativeAchievement?.band??'-'}</b> · Org: <b>${s.organisation?.band??'-'}</b> · Lang: <b>${s.language?.band??'-'}</b>
      <br><span class="muted">Overall: ${d.overall?.label||''}</span>`;
    // edits
    const list = document.getElementById('edits'); list.innerHTML='';
    (d.edits||[]).slice(0,30).forEach(e=>{
      const li=document.createElement('li');
      li.innerHTML = `<code>${e.span?.text||''}</code> → <b>${e.suggestion||''}</b><br><span class="muted">${e.explanation||''}</span>`;
      list.appendChild(li);
    });
    // next
    const ul=document.getElementById('next'); ul.innerHTML='';
    (d.nextDraft?.priorities||[]).forEach(p=>{ const li=document.createElement('li'); li.textContent=p; ul.appendChild(li); });

    // output wc pill
    const out = (d.counts?.words)||0; const lbl=(window.__i18n?.[lang]?.['io.output_words']||'Output: {n} words').replace('{n}', out);
    outEl.className='pill'; outEl.textContent = lbl;
    const win = d.wordCountCheck||{}; if(win.status==='ok') outEl.classList.add('ok'); else if(win.status) outEl.classList.add('warn');
  }

  // Inline mock when ?dev=1 — deterministic but useful
  function mockCorrect(req){
    const wc = wordCount(req.studentText);
    const lvl=req.level; const target=p2TargetForLevel(lvl);
    const status = wc<target.min? 'low' : wc>target.max? 'high' : 'ok';
    const seed = wc%5;
    const bandBase = {B2:2, C1:3, C2:3}[lvl]||3;
    function edit(spanText, suggestion, explanation){
      const pos=Math.max(0, Math.min((req.studentText||'').length-1, Math.floor((wc+spanText.length)*3.1)));
      return { span:{start:pos,end:pos+spanText.length,text:spanText}, type:'lexis', suggestion, explanation };
    }
    return {
      meta:{level:lvl,taskType:'essay',processingMs:12,model:'mock:v1',version:'ec-mock-v1'},
      counts:{words:wc, sentences: Math.max(1,Math.floor(wc/15)), paragraphs: Math.max(1,Math.floor(wc/90))},
      wordCountCheck:{min:target.min,max:target.max,status},
      scores:{
        content:{band:bandBase + (seed>2?1:0),explanation:'Addresses task reasonably well.'},
        communicativeAchievement:{band:bandBase,explanation:'Register mostly appropriate.'},
        organisation:{band:bandBase-1+ (seed>1?1:0),explanation:'Coherent with minor lapses.'},
        language:{band:bandBase-1+ (seed>3?1:0),explanation:'Some awkward collocations.'}
      },
      overall:{band:bandBase,label: (bandBase>=3? 'Borderline pass' : 'Needs work') + ' ' + lvl},
      edits:[
        edit('very big','significant','More formal and concise for exam register.'),
        edit('a lot of','considerable','Avoid informal quantifiers at this level.'),
        { span:{start:0,end:1,text:','}, type:'punctuation_join', suggestion:';', explanation:'Avoid comma splices; use a semicolon or a linker.' }
      ],
      inlineDiff:'',
      cohesion:{ linkers:['Firstly','Moreover','However'], gaps: status!=='ok'?['Word count outside target window']:[] },
      register:{ issues: seed%2? ['colloquial phrase detected'] : [], tone:'mostly formal' },
      nextDraft:{ priorities:['Tighten thesis in P1','Vary sentence openings','Fix comma splices (2)'] }
    };
  }
})();
```

---

## apps/web/es/index.html (redirect shell)

```html
<!doctype html>
<html lang="es"><head>
<meta charset="utf-8">
<title>Redirigiendo…</title>
<meta http-equiv="refresh" content="0; url=../index.html?lang=es">
<script>location.replace("../index.html?lang=es");</script>
</head><body>Redirigiendo…</body></html>
```

---

## apps/server/wrangler.toml (Cloudflare Worker)

```toml
name = "essaycoach-api"
main = "src/worker.js"
compatibility_date = "2024-10-01"

[vars]
CORS_ORIGIN = "*" # tighten later to your Pages origin
```

## apps/server/src/worker.js

```js
export default {
  async fetch(request, env) {
    const url = new URL(request.url);
    const cors = { 'Access-Control-Allow-Origin': env.CORS_ORIGIN||'*', 'Access-Control-Allow-Headers':'*' };
    if (request.method === 'OPTIONS') return new Response(null,{headers:cors});

    if (url.pathname === '/api/health') {
      return new Response(JSON.stringify({ok:true, ts:Date.now()}), {headers:{'Content-Type':'application/json',...cors}});
    }

    if (url.pathname === '/api/correct' && request.method === 'POST') {
      const req = await request.json();
      const wc = (req.studentText||'').trim().split(/\s+/).filter(Boolean).length;
      const map={B2:{min:140,max:190}, C1:{min:220,max:260}, C2:{min:240,max:280}};
      const t = map[req.level]||map.C1; const status = wc<t.min? 'low' : wc>t.max? 'high' : 'ok';
      const resp = {
        meta:{level:req.level||'C1',taskType:req.taskType||'essay',processingMs:5,model:'worker:mock',version:'ec-worker-mock'},
        counts:{words:wc, sentences: Math.max(1,Math.floor(wc/15)), paragraphs: Math.max(1,Math.floor(wc/90))},
        wordCountCheck:{min:t.min,max:t.max,status},
        scores:{
          content:{band:3,explanation:'Addresses most parts of the task.'},
          communicativeAchievement:{band:3,explanation:'Register mostly consistent.'},
          organisation:{band:3,explanation:'Logical flow with minor issues.'},
          language:{band:3,explanation:'Some inaccuracies but generally clear.'}
        },
        overall:{band:3,label:`Borderline pass ${req.level||'C1'}`},
        edits:[{span:{start:0,end:0,text:''},type:'lexis',suggestion:'considerable',explanation:'Prefer formal register.'}],
        inlineDiff:'', cohesion:{linkers:['Firstly','Moreover','However']}, register:{issues:[],tone:'mostly formal'},
        nextDraft:{priorities:['Clarify thesis','Improve paragraph openers','Fix comma splices (if any)']}
      };
      return new Response(JSON.stringify(resp), {headers:{'Content-Type':'application/json',...cors}});
    }

    return new Response('Not Found', {status:404, headers:cors});
  }
}
```

## apps/server/package.json

```json
{
  "name": "essaycoach-api",
  "private": true,
  "version": "0.1.0",
  "scripts": {
    "dev": "wrangler dev",
    "deploy": "wrangler deploy"
  },
  "devDependencies": {
    "wrangler": "^3.80.0"
  }
}
```

---

## .github/workflows/web.yml (deploy Pages)

```yaml
name: Deploy web to GitHub Pages
on:
  push:
    branches: [ main ]
permissions:
  contents: read
  pages: write
  id-token: write
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: apps/web
  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

## .github/workflows/server.yml (deploy Worker)

```yaml
name: Deploy API (Cloudflare Worker)
on:
  push:
    branches: [ main ]
    paths:
      - 'apps/server/**'
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '20' }
      - name: Install wrangler
        run: npm -C apps/server ci
      - name: Publish
        run: npx -C apps/server wrangler deploy
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
```

---

### How to run

1. **API**: `cd apps/server && npm i && npm run dev` → note the Worker URL (e.g., `http://127.0.0.1:8787`).
2. **Web**: open `apps/web/index.html` with Live Server **or** push to Pages.
3. In the browser, add `?api=http://127.0.0.1:8787` (or your deployed Worker) **or** add `?dev=1` to use the in-browser mock.

This thin slice gets you a visible end‑to‑end correction flow today. Next, we can swap the mock body in the Worker for a strict JSON‑schema‑validated LLM pipeline and add real rubric weights.

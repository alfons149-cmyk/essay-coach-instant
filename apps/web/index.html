<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EssayCoach – Cambridge Toolkit</title>

  <!-- Styles -->
  <link rel="stylesheet" href="./css/style.css" />

  <script>
window.I18N = (function(){
  const FALLBACK_LANG = 'en';
  const SUPPORTED = ['en','es','nl'];

  let current = localStorage.getItem('ec.lang') || FALLBACK_LANG;
  if (!SUPPORTED.includes(current)) current = FALLBACK_LANG;

  async function load(lang){
    const url = `./i18n/${lang}.json`;
    const res = await fetch(url);
    if (!res.ok) throw new Error(`i18n load failed: ${lang}`);
    const dict = await res.json();
    current = lang;
    localStorage.setItem('ec.lang', lang);
    translateDOM(dict);
  }

  function t(key, dict){
    return (dict && dict[key]) || key;
  }

  function translateDOM(dict){
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.getAttribute('data-i18n');
      el.textContent = t(key, dict);
    });
    // placeholders
    document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
      const key = el.getAttribute('data-i18n-ph');
      el.setAttribute('placeholder', t(key, dict));
    });
  }

  return { load, get lang(){ return current; } };
})();
</script>
  <!-- Detect ?lang=es or /es/ and expose to JS -->
  <script>
    (function () {
      const qs = new URLSearchParams(location.search);
      const qp = qs.get('lang');
      const pathIsEs = location.pathname.replace(/\/+$/, '').endsWith('/es') || location.pathname.includes('/es/');
      const lang = /^(en|es)$/.test(qp || '') ? qp : (pathIsEs ? 'es' : 'en');
      document.documentElement.setAttribute('lang', lang);
      window.__EC_LANG = lang;
    })();
  </script>

  <script>
document.addEventListener('click', (e)=>{
  const btn = e.target.closest('[data-lang]');
  if (!btn) return;
  const lang = btn.getAttribute('data-lang');
  window.I18N.load(lang).catch(err=>console.error(err));
});
</script>
  
  <!-- App scripts (order matters: i18n before app) -->
  <script defer src="./js/i18n.js"></script>
  <script defer src="./js/config.js"></script>
  <script defer src="./js/ec_sentences.js"></script>
  <script defer src="./js/app.js"></script>

  <!-- Inline styles (keep or move to style.css) -->
  <style>
    body{font-family:Inter,system-ui,Arial,sans-serif; margin:0;}
    header,footer{padding:12px 16px}
    .container{max-width:1000px;margin:0 auto;padding:16px}
    textarea{width:100%;min-height:220px;padding:12px;font-size:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #bbb}
    .pill.ok{background:#e7f7ea;border-color:#58a869}
    .pill.warn{background:#fff6e6;border-color:#d08b39}
    .btn{padding:8px 12px;border:1px solid #222;border-radius:10px;background:#111;color:#fff;cursor:pointer}
    .btn.ghost{background:#fff;color:#111;border-color:#aaa}
    .panel{border:1px solid #ddd;border-radius:12px;padding:12px}
    .muted{color:#666}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<header class="row">
<strong>EssayCoach</strong>
<span class="muted" id="devBanner" style="display:none">DEV MODE</span>
<span style="margin-left:auto">
<select id="level">
<option value="B2">B2</option>
<option value="C1" selected>C1</option>
<option value="C2">C2</option>
</select>
</span>
  <span style="margin-left:auto" class="row">
  <select id="level">
    <option value="B2">B2</option>
    <option value="C1" selected>C1</option>
    <option value="C2">C2</option>
  </select>

  <!-- Language toggle -->
  <div id="langToggle" class="lang-toggle">
    <button type="button" data-lang="en" class="lang-btn">EN</button>
    <button type="button" data-lang="es" class="lang-btn">ES</button>
    <button type="button" data-lang="nl" class="lang-btn">nl</button>
  </div>
</span>
</header>

<main class="container">
<div class="grid">
<section class="panel">
<h3 data-i18n="labels.prompt">Task prompt</h3>
<textarea id="task" placeholder="Paste the exam task here..."></textarea>
<h3 data-i18n="labels.essay">Your essay</h3>
<textarea id="essay" placeholder="Paste or write your essay here..."></textarea>
<div class="row" style="align-items:center;justify-content:space-between">
<div class="row">
<span class="pill" id="inWC">Input: 0 words</span>
<span class="pill" id="outWC">Output: 0 words</span>
<span class="pill" id="p2TargetWC">—</span>
</div>
<div class="row">
<button class="btn" id="btnCorrect" data-i18n="buttons.correct">Correct</button>
<button class="btn ghost" id="btnClear" data-i18n="buttons.clear">Clear</button>
</div>
</div>
</section>

<section class="panel">
<h3 data-i18n="labels.feedback">Feedback</h3>
<div id="scores" class="muted">—</div>
<h4>Edits</h4>
<ol id="edits"></ol>
<h4>Next draft</h4>
<ul id="next"></ul>
</section>
</div>
</main>

<footer class="container muted">
<small>API: <span id="apiInfo">(auto)</span></small>
</footer>
</body>
</html>

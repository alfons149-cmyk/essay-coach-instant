<!doctype html>
<html lang="es" data-theme="coral">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-i18n="app.title">EssayCoach – Instant</title>

  <!-- Reuse parent assets -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="../assets/styles.css" />

  <!-- Tiny i18n loader -->
  <script>
  (function () {
    async function loadI18n(lang, basePath) {
      try {
        const res = await fetch(`${basePath}/assets/i18n/${lang}.json`, { cache: 'no-store' });
        const dict = await res.json();

        document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          if (dict[key]) el.textContent = dict[key];
        });
        document.querySelectorAll('[data-i18n-title]').forEach(el => {
          const key = el.getAttribute('data-i18n-title');
          if (dict[key]) el.setAttribute('title', dict[key]);
        });
        document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
          const key = el.getAttribute('data-i18n-placeholder');
          if (dict[key]) el.setAttribute('placeholder', dict[key]);
        });

        // small templating helper for counts like "Input: {n} words"
        window.EC_t = (key, vars = {}) => {
          let s = dict[key] || key;
          for (const k in vars) s = s.replaceAll(`{${k}}`, String(vars[k]));
          return s;
        };

        document.documentElement.lang = lang;
      } catch (e) {
        console.error('i18n load error', e);
      }
    }
    const isSpanish = location.pathname.includes('/essay-coach-instant/es/');
    const lang = isSpanish ? 'es' : 'en';
    const basePath = isSpanish ? '/essay-coach-instant' : '';
    loadI18n(lang, basePath);
  })();
  </script>
</head>

<body>
  <!-- Language switch -->
  <nav class="lang-switch" style="margin:12px 0">
    <a href="/essay-coach-instant/" data-i18n="nav.english_ui">English</a> |
    <a href="/essay-coach-instant/es/" data-i18n="nav.spanish_ui">Español</a>
  </nav>

  <!-- Hero / overview -->
  <header>
    <h1 data-i18n="app.title">EssayCoach – Instant</h1>
    <p class="hint" data-i18n="home.hero_line">
      Andamiajes • Corrector (B2–C2) • Notas del entrenador • Resaltados y saltos • Reglas de puntuación • Guía y ejemplo • PDF
    </p>
  </header>

  <!-- Top tabs (mirror of your live headings) -->
  <nav class="tabs" style="margin:8px 0 16px">
    <a href="#scaffolds" data-i18n="tabs.scaffolds">Andamiajes</a> •
    <a href="#corrector" data-i18n="tabs.corrector">Corrector</a> •
    <a href="#punct" data-i18n="tabs.punct_rules">¿Reglas de puntuación? Parte 2 (Carta/Email • Propuesta • Informe • Reseña)</a>
  </nav>

  <!-- SCAFFOLDS -->
  <section id="scaffolds">
    <h2 data-i18n="tabs.scaffolds">Andamiajes</h2>

    <!-- Level / Task controls -->
    <div class="controls">
      <label for="levelSel" data-i18n="label.level">Nivel</label>
      <div id="levelSel">
        <label><input type="radio" name="level" value="b2"> <span data-i18n="level.b2">B2 First</span></label>
        <label><input type="radio" name="level" value="c1"> <span data-i18n="level.c1">C1 Advanced</span></label>
        <label><input type="radio" name="level" value="c2"> <span data-i18n="level.c2">C2 Proficiency</span></label>
      </div>

      <label for="taskType" data-i18n="label.task_type">Tipo de tarea</label>
      <select id="taskType">
        <option value="essay" data-i18n="task.essay">Ensayo</option>
        <option value="report" data-i18n="task.report">Informe</option>
        <option value="review" data-i18n="task.review">Reseña</option>
        <option value="letter_email" data-i18n="task.letter_email">Carta / Email</option>
        <option value="proposal" data-i18n="task.proposal">Propuesta</option>
      </select>

      <div class="task-setup">
        <div class="title" data-i18n="label.task_setup">Preparación de la tarea</div>
        <!-- Your app renders its own setup UI here -->
      </div>
    </div>

    <!-- Scaffold actions -->
    <div class="actions">
      <button id="btnCopyScaffold" data-i18n="btn.copy_scaffold">Copiar andamiaje</button>
      <button id="btnCopyOpener" data-i18n="btn.copy_opener">Copiar apertura</button>
      <button id="btnExportScaffoldPDF" data-i18n="btn.export_scaffold_pdf">Exportar andamiaje en PDF</button>
      <button id="btnGuideExample" data-i18n="btn.guide_example">Guía y ejemplo</button>
      <span class="hint" style="display:block;margin-top:8px" data-i18n="guide.about">
        “Guía y ejemplo” muestra una respuesta modelo completa para el Nivel + Tipo de tarea seleccionados. Activa o desactiva las notas del entrenador dentro del modal.
      </span>
    </div>

    <!-- Structure / Moves / Opener / Tips -->
    <h3 data-i18n="section.structure">Estructura</h3>

    <h4 data-i18n="section.moves_title">Movimientos recomendados (estructura en 4 partes)</h4>
    <div id="movesList"><!-- app fills --></div>

    <hr />

    <h4 data-i18n="section.useful_opener">Apertura útil (ejemplo)</h4>
    <div id="usefulOpener"><!-- example remains in English --></div>

    <hr />

    <h4 data-i18n="section.tips">Consejos</h4>
    <p class="hint" data-i18n="hint.choose_level">
      Elige nivel y tipo de tarea para actualizar el andamiaje. Puedes copiar o exportar a PDF.
    </p>

    <p class="reminder" data-i18n="reminder.essay_counts">
      Recordatorios para el ensayo: B2 140–190 • C1 220–260 • C2 240–280. Parafrasea los enunciados, organiza con claridad y mantén un registro académico / neutral–formal.
    </p>
  </section>

  <hr />

  <!-- CORRECTOR (Part 1) -->
  <section id="corrector">
    <h2 data-i18n="tabs.corrector">Corrector</h2>

    <!-- Small status row (mirrors your live copy) -->
    <div class="status-row">
      <span id="inputWords" data-i18n="io.input_words">Entrada: {n} palabras</span> •
      <span id="outputWords" data-i18n="io.output_words">Salida: {n} palabras</span> •
      <span id="targetHint" data-i18n="io.target_example_c1">Objetivo 220–260 (ensayo C1)</span>
    </div>

    <!-- Toggles -->
    <div class="toggles">
      <label><input type="checkbox" id="enforceFormal"> <span data-i18n="controls.enforce_formal">Forzar registro formal (evita jerga/coloquialismos)</span></label><br />
      <label><input type="checkbox" id="useAI"> <span data-i18n="controls.use_ai">Usar IA (ChatGPT) con estilo alineado al examen (requiere Worker URL)</span></label><br />
      <label><input type="checkbox" id="showCoach"> <span data-i18n="controls.show_coach_notes">Mostrar notas del entrenador y resaltados para la puntuación entre cláusulas (B2↔C1)</span></label>
    </div>

    <!-- IO panes (keep IDs so your app can hook) -->
    <div class="io">
      <div class="io-col">
        <div class="io-title" data-i18n="io.input_label">Entrada</div>
        <textarea id="userInput" rows="10" data-i18n-placeholder="io.input_label" placeholder="Entrada"></textarea>
      </div>
      <div class="io-col">
        <div class="io-title" data-i18n="io.output_label">Salida</div>
        <textarea id="correctedOutput" rows="10" readonly></textarea>
      </div>
    </div>

    <!-- Actions -->
    <div class="actions" aria-label="actions">
      <button id="btnCorrect" data-i18n="btn.correct">Corregir</button>
      <button id="btnExportPDF" data-i18n="btn.export_pdf">Exportar PDF</button>
      <button id="btnClear" data-i18n="btn.clear">Limpiar</button>
      <button id="btnPaste" data-i18n="btn.paste">Pegar</button>
      <button id="btnStartTimer" data-i18n="btn.start_timer">Iniciar temporizador de 45 min</button>
      <span id="timerBadge" style="margin-left:8px" data-i18n="io.timer_dash">Temporizador: --:--</span>
    </div>

    <!-- Preview + Notes -->
    <div class="preview">
      <h3 data-i18n="preview.title">Vista previa con resaltados (haz clic en una etiqueta para saltar; haz clic en un resaltado para alternar)</h3>
      <p data-i18n="preview.instructions">Pega tu texto y pulsa Corregir. Mostraremos las uniones de cláusulas (FANBOYS / adverbios conjuntivos) y Notas del entrenador para alcanzar C1.</p>
      <div id="previewHTML"><!-- app fills --></div>

      <h4 data-i18n="preview.changes_title">Cambios:</h4>
      <div id="changesList"><em data-i18n="preview.changes_wait">Las correcciones aparecerán aquí después de pulsar “Corregir”.</em></div>
    </div>

    <!-- C2 quick rubric -->
    <section class="c2-rubric">
      <h3 data-i18n="c2.quick_rubric_title">C2 (CPE) rúbrica rápida – prototipo</h3>
      <div id="c2Rubric"><em data-i18n="c2.quick_rubric_wait">Ejecuta una corrección para ver la retroalimentación.</em></div>
    </section>

    <!-- Vocab alternatives -->
    <section class="vocab-alts">
      <h3 data-i18n="vocab.alternatives_title">Alternativas de vocabulario (haz clic para aplicar)</h3>
      <div id="vocabAlts"><em data-i18n="vocab.alternatives_wait">Tras la corrección, aparecerán mejoras sugeridas (especialmente para C1/C2).</em></div>
    </section>

    <!-- Essay reminders -->
    <p class="reminder" data-i18n="reminder.essay_counts">Recordatorios para el ensayo: B2 140–190 • C1 220–260 • C2 240–280. Parafrasea los enunciados, organiza con claridad y mantén un registro académico / neutral–formal.</p>
  </section>

  <hr />

  <!-- PUNCTUATION RULES (Part 2 area mention is mirrored in tabs) -->
  <section id="punct">
    <div class="actions" style="margin:8px 0">
      <button id="btnCopyRules" data-i18n="punct.copy_rules">Copiar reglas</button>
      <button id="btnExportRulesPDF" data-i18n="punct.export_rules_pdf">Exportar reglas en PDF</button>
    </div>

    <h3 data-i18n="punct.core_rules_title">Reglas básicas de puntuación (seguras para examen)</h3>
    <div id="punctRules"><em data-i18n="punct.placeholder">Estos son marcadores de posición. Cámbialos por tus propias reglas más adelante.</em></div>
  </section>

  <hr />

  <!-- PART 2 corrector -->
  <section id="part2">
    <h2 data-i18n="part2.corrector_title">Corrector de la Parte 2</h2>

    <div class="controls">
      <label data-i18n="part2.level">Nivel</label>
      <div>
        <label><input type="radio" name="p2level" value="b2"> <span data-i18n="level.b2">B2 First</span></label>
        <label><input type="radio" name="p2level" value="c1"> <span data-i18n="level.c1">C1 Advanced</span></label>
        <label><input type="radio" name="p2level" value="c2"> <span data-i18n="level.c2">C2 Proficiency</span></label>
      </div>

      <label data-i18n="part2.task_type">Tipo de tarea</label>
      <div>
        <label><input type="radio" name="p2type" value="letter_email"> <span data-i18n="task.letter_email">Carta / Email</span></label>
        <label><input type="radio" name="p2type" value="proposal"> <span data-i18n="task.proposal">Propuesta</span></label>
        <label><input type="radio" name="p2type" value="report"> <span data-i18n="task.report">Informe</span></label>
        <label><input type="radio" name="p2type" value="review"> <span data-i18n="task.review">Reseña</span></label>
      </div>

      <div class="task-setup">
        <span class="muted" data-i18n="part2.tasks_line">Carta/Email, Propuesta, Informe, Reseña</span>
      </div>
    </div>

    <div class="status-row">
      <span id="p2InputWords" data-i18n="io.input_words">Entrada: {n} palabras</span> •
      <span id="p2OutputWords" data-i18n="io.output_words">Salida: {n} palabras</span> •
      <span id="p2Target" data-i18n="part2.target">Objetivo —</span> •
      <span id="p2TimerNote" data-i18n="part2.mirror_timer">El temporizador refleja el principal</span>
    </div>

    <div class="toggles">
      <label><input type="checkbox" id="p2Formal"> <span data-i18n="part2.enforce_formal">Forzar registro formal (desactívalo para una reseña más neutral)</span></label><br />
      <label><input type="checkbox" id="p2UseAI"> <span data-i18n="part2.use_ai">Usar IA (ChatGPT) con género alineado (requiere Worker URL)</span></label><br />
      <label><input type="checkbox" id="p2ShowCoach"> <span data-i18n="part2.show_coach_notes">Mostrar notas del entrenador y resaltados para la puntuación entre cláusulas</span></label>
    </div>

    <p class="reminder" data-i18n="part2.wordcount_note">
      Objetivos de palabras: B2 140–190 • C1 220–260 • C2 240–280. Los registros varían por género: Carta/Email, Propuesta, Informe → formal; Reseña → neutral/semi-formal.
    </p>

    <div class="io">
      <div class="io-col">
        <div class="io-title" data-i18n="io.input_label">Entrada</div>
        <textarea id="p2Input" rows="10" data-i18n-placeholder="io.input_label" placeholder="Entrada"></textarea>
      </div>
      <div class="io-col">
        <div class="io-title" data-i18n="io.output_label">Salida</div>
        <textarea id="p2Output" rows="10" readonly></textarea>
      </div>
    </div>

    <div class="actions">
      <button id="p2Correct" data-i18n="btn.correct">Corregir</button>
      <button id="p2ExportPDF" data-i18n="btn.export_pdf">Exportar PDF</button>
      <button id="p2Clear" data-i18n="btn.clear">Limpiar</button>
      <button id="p2Paste" data-i18n="btn.paste">Pegar</button>
      <button id="p2StartTimer" data-i18n="btn.start_timer">Iniciar temporizador de 45 min</button>
    </div>

    <div class="preview">
      <h3 data-i18n="part2.preview_title">Vista previa con resaltados</h3>
      <p data-i18n="part2.preview_hint">Pega tu texto y pulsa Corregir para ver las uniones de cláusulas y las notas del entrenador.</p>
      <div id="p2PreviewHTML"><!-- app fills --></div>

      <h4 data-i18n="preview.changes_title">Cambios:</h4>
      <div id="p2ChangesList"><em data-i18n="part2.changes_wait">Las correcciones aparecerán aquí después de pulsar “Corregir”.</em></div>
    </div>

    <section class="p2-rubric">
      <h3 data-i18n="part2.quick_rubric_title">Rúbrica rápida de la Parte 2 – comprobaciones por género</h3>
      <div id="p2Rubric"><em data-i18n="part2.quick_rubric_wait">Ejecuta una corrección para ver retroalimentación específica para carta/propuesta/informe/reseña.</em></div>
    </section>

    <section class="p2-vocab-alts">
      <h3 data-i18n="part2.vocab_alts_title">Alternativas de vocabulario (haz clic para aplicar)</h3>
      <div id="p2VocabAlts"><em data-i18n="part2.vocab_alts_wait">Tras la corrección, aparecerán mejoras sugeridas.</em></div>
    </section>
  </section>

  <!-- Guide & Example modal (titles/buttons only translated; example content stays EN) -->
  <dialog id="guideModal">
    <h3 id="guideModalTitle" data-i18n="modal.guide_title">Guía y ejemplo</h3>
    <div id="guideModalBody"><!-- example remains in English --></div>
    <div class="actions">
      <button id="btnCopyExample" data-i18n="modal.copy_example">Copiar ejemplo</button>
      <button id="btnExportExamplePDF" data-i18n="modal.export_example_pdf">Exportar ejemplo en PDF</button>
      <button id="btnCloseGuide" data-i18n="modal.close">Cerrar</button>
    </div>
  </dialog>

  <!-- Coach notes modal (if you use one) -->
  <dialog id="coachNotesModal">
    <h3 data-i18n="modal.coach_notes_title">Notas del entrenador (redacción B2/C1)</h3>
    <div id="coachNotes"><!-- generated notes here, stays EN if your engine writes in EN --></div>
    <div class="actions">
      <button id="btnCloseCoach" data-i18n="modal.close">Cerrar</button>
    </div>
  </dialog>

  <!-- Reuse your main bundle from parent -->
  <script src="../assets/app.bundle.js" defer></script>
</body>
</html>

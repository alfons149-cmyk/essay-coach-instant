<!doctype html>
<html lang="en" class="book-html">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>The Cambridge Writing Coach – Reader</title>

  <!-- Same stylesheet as your TOC page -->
  <link rel="stylesheet" href="book.css">
</head>
<body class="book-body">

  <!-- Top header: title + back to app -->
  <header class="book-header">
    <div class="book-header-left">
      <h1 class="book-title">The Cambridge Writing Coach</h1>
      <p class="book-subtitle">Mastering Essay Writing for Cambridge Exams (B2–C2)</p>
    </div>

    <nav class="book-nav">
      <!-- Back to the app -->
      <a class="book-home" href="https://alfons149-cmyk.github.io/essay-coach-instant/">
        ← Back to EssayCoach
      </a>
    </nav>
  </header>

  <!-- Unit selector + reading area -->
  <main class="book-main">
    <header class="reader-header">
      <p class="unit-label">Course Book</p>
      <h1>Unit Reader</h1>
      <p class="reader-intro">
        Choose a unit on the left. The content will open here without leaving the book.
      </p>
    </header>

    <div class="reader-layout">
      <!-- Left side: unit buttons -->
      <nav class="reader-nav">
        <!-- You can add more buttons later up to 20 -->
        <button type="button" class="unit-pill reader-unit-btn" data-unit="1">Unit 1</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="2">Unit 2</button>
        <!-- Example for future units:
        <button type="button" class="unit-pill reader-unit-btn" data-unit="3">Unit 3</button>
        -->
      </nav>

      <!-- Right side: unit content gets loaded here -->
      <section id="unit-content" class="reader-main">
        <p>Select a unit to start reading.</p>
      </section>
    </div>
  </main>

  <script>
    (function () {
      const contentEl = document.getElementById('unit-content');
      const buttons = Array.from(document.querySelectorAll('.reader-unit-btn'));

      function getUnitFromURL() {
        const qs = new URLSearchParams(location.search);
        return qs.get('unit') || '1'; // default to Unit 1
      }

      function setActiveButton(unitId) {
        buttons.forEach(btn => {
          btn.classList.toggle('is-active', btn.dataset.unit === String(unitId));
        });
      }

      async function loadUnit(unitId) {
        setActiveButton(unitId);
        contentEl.innerHTML = '<p>Loading unit…</p>';

        try {
          const fileId = String(unitId).padStart(2, '0'); // 1 → "01", 2 → "02"
          // Units live in /book/units/unit01.html, unit02.html, etc.
          const response = await fetch(`units/unit${fileId}.html`);
          if (!response.ok) throw new Error('Unit not found');
          const html = await response.text();
          contentEl.innerHTML = html;

          // Update URL (reader.html?unit=2) without reloading
          const qs = new URLSearchParams(location.search);
          qs.set('unit', unitId);
          history.replaceState(null, '', `${location.pathname}?${qs.toString()}`);
        } catch (err) {
          console.error(err);
          contentEl.innerHTML = '<p>Sorry, this unit could not be loaded.</p>';
        }
      }

      // Button clicks
      buttons.forEach(btn => {
        btn.addEventListener('click', () => loadUnit(btn.dataset.unit));
      });

      // Initial load from ?unit=… in URL
      const initialUnit = getUnitFromURL();
      loadUnit(initialUnit);
    })();
  </script>
</body>
</html>

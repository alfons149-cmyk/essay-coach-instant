<!doctype html>
<html lang="en" class="book-html">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>The Cambridge Writing Coach – Reader</title>

  <!-- Same stylesheet as your TOC page -->
  <link rel="stylesheet" href="book.css">
</head>
<body class="book-body">

  <!-- Top header: title + back to app -->
  <header class="book-header">
    <div class="book-header-left">
      <h1 class="book-title">The Cambridge Writing Coach</h1>
      <p class="book-subtitle">Mastering Essay Writing for Cambridge Exams (B2–C2)</p>
    </div>

    <nav class="book-nav">
      <!-- Back to the app -->
      <a class="book-home" href="https://alfons149-cmyk.github.io/essay-coach-instant/">
        ← Back to EssayCoach
      </a>
    </nav>
  </header>

  <!-- Unit selector + reading area -->
  <main class="book-main">
    <header class="reader-header">
      <p class="unit-label">Course Book</p>
      <h1>Unit Reader</h1>
      <p class="reader-intro">
        Choose a unit on the left. The content will open here without leaving the book.
      </p>
    </header>

    <div class="reader-layout">
      <!-- Left side: unit buttons -->
      <nav class="reader-nav">
        <button type="button" class="unit-pill reader-unit-btn" data-unit="1">Unit 1</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="2">Unit 2</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="3">Unit 3</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="4">Unit 4</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="5">Unit 5</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="6">Unit 6</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="7">Unit 7</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="8">Unit 8</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="9">Unit 9</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="10">Unit 10</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="11">Unit 11</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="12">Unit 12</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="13">Unit 13</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="14">Unit 14</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="15">Unit 15</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="16">Unit 16</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="17">Unit 17</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="18">Unit 18</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="19">Unit 19</button>
        <button type="button" class="unit-pill reader-unit-btn" data-unit="20">Unit 20</button>
      </nav>

      <!-- Right side: unit content gets loaded here -->
      <section id="unit-content" class="reader-main">
        <p>Select a unit to start reading.</p>
      </section>
    </div>
  </main>

  <!-- Floating back-to-essay button -->
<button id="back-to-essay-fab" class="back-to-essay-fab">
  ← Back to essay
</button>

  <!-- Single, clean script that matches the HTML above -->
  <script>
    (function () {
      const contentEl = document.getElementById('unit-content');
      const buttons = Array.from(document.querySelectorAll('.reader-unit-btn'));

      function getUnitFromURL() {
        const qs = new URLSearchParams(window.location.search);
        const unitParam = qs.get('unit');
        const unitNum = unitParam ? Number(unitParam) : NaN;
        return Number.isFinite(unitNum) && unitNum >= 1 && unitNum <= 20
          ? String(unitNum)
          : null;
      }

      function setActiveButton(unitId) {
        buttons.forEach(btn => {
          btn.classList.toggle('is-active', btn.dataset.unit === String(unitId));
        });
      }

      async function loadUnit(unitId) {
        if (!contentEl) return;

        setActiveButton(unitId);
        contentEl.innerHTML = '<p>Loading…</p>';

        try {
          const fileId = String(unitId).padStart(2, '0'); // 1 → "01"
          const url = `units/unit${fileId}.html`;         // relative to /assets/book/reader.html

          const response = await fetch(url);
          if (!response.ok) throw new Error('Unit not found');

          const html = await response.text();
          contentEl.innerHTML = html;

          // If there is a hash (e.g. #u16-formality), scroll to that section
          if (window.location.hash) {
            const target = contentEl.querySelector(window.location.hash);
            if (target) {
              target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }

          // Update URL (reader.html?unit=2#u2-...)
          const qs = new URLSearchParams(window.location.search);
          qs.set('unit', unitId);
          const newUrl = `${window.location.pathname}?${qs.toString()}${window.location.hash}`;
          history.replaceState(null, '', newUrl);
        } catch (err) {
          console.error(err);
          contentEl.innerHTML = '<p>Sorry, this content could not be loaded.</p>';
        }
      }

      // Button clicks
      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          const unit = btn.dataset.unit;
          loadUnit(unit);
        });
      });

      // Initial load (from ?unit=… in URL, e.g. ?unit=16)
      const initialUnit = getUnitFromURL() || '1'; // default to Unit 1 if none
      loadUnit(initialUnit);
    })();
  </script>

  <script>
  (function () {
    const btn = document.getElementById("back-to-essay-fab");
    if (!btn) return;

    btn.addEventListener("click", () => {
      // If this tab was opened from EssayCoach, just close it
      if (window.opener && !window.opener.closed) {
        window.close();
      } else {
        // Fallback: go to the main EssayCoach app
        window.location.href =
          "https://alfons149-cmyk.github.io/essay-coach-instant/";
      }
    });
  })();
</script>

  <script>
  (function () {
    const btn = document.getElementById("back-to-essay-fab");
    if (!btn) return;

    btn.addEventListener("click", () => {
      const params = new URLSearchParams(window.location.search);
      const ret = params.get("return");

      // 1) Best case: this tab was opened from EssayCoach → just close it
      if (window.opener && !window.opener.closed) {
        window.close();
        return;
      }

      // 2) If we have a return URL, go there
      if (ret) {
        window.location.href = ret;
        return;
      }

      // 3) Last fallback: go to the app home
      window.location.href =
        "https://alfons149-cmyk.github.io/essay-coach-instant/";
    });
  })();
</script>



</body>
</html>

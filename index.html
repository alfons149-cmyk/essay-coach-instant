<!doctype html>
<html data-theme="coral">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EssayCoach – Cambridge Toolkit (Unified EN/ES)</title>
  <meta name="x-build" content="v2025-09-15-unified-coral-punctfix" />
  <link rel="icon" type="image/png" sizes="192x192" href="/essay-coach-instant/icon-192.png">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:wght@400;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/essay-coach-instant/css/style.css">

  <style>
    /* Textbox: readable serif */
    #essayIn {
      font-family: "IBM Plex Serif", Georgia, "Times New Roman", serif;
      font-size: 16px;
      line-height: 1.7;
      padding: 12px 14px;
      letter-spacing: 0.005em;
    }

    /* Preview: spacing for paragraphs */
    #essayOut.preview { white-space: pre-line; line-height: 1.6; }
    #essayOut.preview p { margin: 0 0 0.9em; }
    #essayOut.preview p:last-child { margin-bottom: 0; }

    /* Punctuation guide spacing */
    #punctList { line-height: 1.6; }
    #punctList p { margin: 0 0 0.8em; }
    #punctList ul { margin: 0.5em 0 0.5em 1.2em; padding: 0; list-style: disc; }
    #punctList li { margin: 0.3em 0; }
  </style>
</head>
<body>
  <header>
    <div class="headerbar">
      <div>
        <nav class="row" aria-label="Language switch">
          <a href="/essay-coach-instant/" data-i18n="nav.english">English</a> |
          <a href="/essay-coach-instant/es/" data-i18n="nav.spanish">Español</a>
        </nav>
        <h1 data-i18n="app.title">EssayCoach – Cambridge Toolkit</h1>
      </div>
      <div class="row" style="gap:8px">
        <span id="quotaPill" class="pill">0/20</span>
        <div id="accountMenu"></div>
      </div>
    </div>
    <div id="trialBanner" class="hidden" style="margin:8px 0;padding:10px 12px;border:1px solid #f59e0b;background:#fff7ed;color:#7c2d12;border-radius:10px">
      <strong data-i18n="trial.expiringSoon">Trial ending soon</strong>
      <span id="trialBannerMsg" style="margin-left:8px"></span>
    </div>
  </header>

  <main class="grid">
    <!-- PAYWALL -->
    <section id="paywall" class="card hidden center">
      <h2 data-i18n="paywall.title">Subscribe to use the corrector</h2>
      <p class="muted" data-i18n="paywall.desc">Unlimited corrections, PDF export, and analyzer.</p>
      <div class="row center" style="justify-content:center">
        <button id="btnGoPricing" class="btn-primary" data-i18n="paywall.seePlans">See plans</button>
        <button id="btnStartTrial" class="btn-ghost" data-i18n="paywall.startTrial">Start 2-day trial</button>
      </div>
    </section>

    <!-- PRICING -->
    <section id="pricing" class="card hidden">
      <h2 data-i18n="pricing.title">Plans</h2>
      <ul>
        <li><strong data-i18n="pricing.monthly.name">Monthly</strong> — <span data-i18n="pricing.monthly.price">€10</span> <span class="muted" data-i18n="pricing.monthly.note">per month, auto-renews until cancelled</span></li>
        <li><strong data-i18n="pricing.exam.name">Exam Pack (6 months)</strong> — <span data-i18n="pricing.exam.price">€50</span> <span class="muted" data-i18n="pricing.exam.note">one-time, auto-expires</span></li>
      </ul>
      <div class="row">
        <button id="btnChooseMonthly" class="btn-primary" data-i18n="pricing.chooseMonthly">Choose Monthly</button>
        <button id="btnChooseExam" class="btn-ghost" data-i18n="pricing.chooseExam">Choose Exam Pack</button>
      </div>
    </section>

    <!-- APP BODY -->
    <section id="appBody" class="grid">
      <section id="corrector" class="card">
        <h2 data-i18n="corrector.title">AI Essay Corrector</h2>
        <div class="toolbar">
          <button id="btnCorrect" class="btn-primary" data-i18n="buttons.correct">Correct</button>
          <button id="btnExportPDF" class="btn-ghost" data-i18n="buttons.exportPdf">Export PDF</button>
          <button id="btnClear" class="btn-ghost" data-i18n="buttons.clear">Clear</button>
          <button id="btnPaste" class="btn-ghost" data-i18n="buttons.paste">Paste</button>
          <button id="btnTimer" class="btn-ghost" data-i18n="buttons.startTimer">Start timer</button>
        </div>
        <div class="row">
          <label class="toggle"><input type="checkbox" id="tgFormal" checked> <span data-i18n="toggles.formalTone">Formal tone</span></label>
          <label class="toggle"><input type="checkbox" id="tgCoachNotes" checked> <span data-i18n="toggles.coachNotes">Coach notes</span></label>
          <label class="toggle"><input type="checkbox" id="tgRubric" checked> <span data-i18n="toggles.rubricPoints">Rubric points</span></label>
        </div>
        <textarea id="essayIn" placeholder="Paste your essay here…"></textarea>
        <div id="essayOut" class="preview" aria-live="polite"></div>
        <div class="hint" data-i18n="corrector.hint">The output mirrors Cambridge descriptors. Toggle options above to customise.</div>
      </section>

      <section id="sentences" class="card">
        <h2 data-i18n="sentences.title">Sentence-Type Analysis (simple / compound / complex / compound–complex)</h2>
        <div id="sentenceAnalysis" class="preview"></div>
        <div class="hint" data-i18n="sentences.hint">Hover a sentence to see why it was classified and any issues spotted.</div>
      </section>

      <section id="punct" class="card">
        <h2 data-i18n="punct.header">Core Punctuation Rules (Exam-Safe)</h2>
        <div class="toolbar">
          <button id="btnCopyRules" class="btn-ghost" data-i18n="buttons.copyRules">Copy rules</button>
          <button id="btnExportRules" class="btn-ghost" data-i18n="buttons.exportRules">Export rules as PDF</button>
        </div>
        <div id="punctList" class="preview"></div>
      </section>

      <section id="part2" class="card">
        <h2 data-i18n="part2.title">Part 2 quick rubric – genre checks</h2>
        <div id="part2Rubric" class="preview"></div>
      </section>
    </section>
  </main>

  <!-- Analyzer module -->
  <script src="/essay-coach-instant/js/ec_sentences.js"></script>

  <script>
    // ===== Config =====
    window.EC_CONFIG = { API_BASE:'/api', REQUIRE_SUBSCRIPTION:true, SHOW_TRIAL:true, QUOTA_CAP:20, TRIAL_DAYS:2 };
    window.SESSION = { status:'inactive', email:null, token:null, trialStart:null, trialEnd:null };
    window.QUOTA = { used:0, cap:window.EC_CONFIG.QUOTA_CAP };

    const path = location.pathname.toLowerCase();
    const LOCALE = /\/es(\/|$)/.test(path) ? 'es' : 'en';
    document.documentElement.lang = LOCALE;

    // ===== i18n =====
    const BASE_APP = '/essay-coach-instant';
    async function loadDict(lang){
      const url = `${BASE_APP}/i18n/${lang}.json?v=${Date.now()}`;
      try{ const r = await fetch(url,{cache:'no-store'}); return r.ok ? r.json() : {}; }catch{ return {}; }
    }
    function applyI18n(dict){
      window._i18nDict = dict||{};
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key=el.getAttribute('data-i18n');
        const val=key.split('.').reduce((o,k)=>o&&o[k], dict);
        if(typeof val==='string') el.textContent=val;
      });
    }

    // ===== Punctuation guide renderer =====
    const PUNCT_GUIDE = "<p><strong>Why should you learn about punctuation?</strong><br> Most native speakers don't use punctuation correctly themselves. So, what's the point of learning this? The answer is simple: this is Cambridge. Using punctuation correctly and effectively shows your level and adds value to your composition.</p><ul><li><strong>Full stop (.)</strong> — Use at the end of sentences.</li><li><strong>Comma (,)</strong> — Separate items in a list, clauses, or after connectors.</li><li><strong>Semicolon (;)</strong> — Link closely related independent clauses.</li><li><strong>Colon (:)</strong> — Introduce a list, explanation, or example.</li><li><strong>Dash (—)</strong> — Add emphasis or mark off extra information.</li><li><strong>Apostrophe (’)</strong> — Show possession or form contractions.</li></ul>";

    function renderPunctGuide(){
      const pg=document.getElementById('punctList'); if(!pg) return;
      let html=(window._i18nDict&&window._i18nDict.punct&&window._i18nDict.punct.guide)
        ? window._i18nDict.punct.guide : PUNCT_GUIDE;
      if(/&lt;|&gt;|&amp;/.test(html)){ const ta=document.createElement('textarea'); ta.innerHTML=html; html=ta.value; }
      pg.innerHTML=html;
    }

    // ===== Analyzer hook =====
    function updateSentenceAnalysis(text){
      const box=document.getElementById('sentenceAnalysis');
      if (!box) return;
      box.innerHTML=text?(window.EC_Sentences?.analyzeToHTML(text,{locale:LOCALE})||""):"";
    }

    // ===== Init =====
    async function init(){
      const dict=await loadDict(LOCALE);
      try{ applyI18n(dict);}catch(e){console.warn('i18n failed',e);}
      renderPunctGuide();
    }
    init();
  </script>
</body>
</html>

<!doctype html>
<html lang="en" data-theme="coral">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Title translates via i18n -->
  <title data-i18n="meta.title">EssayCoach – Cambridge Toolkit (EN)</title>

  <!-- GitHub Pages base (project pages) -->
  <base href="/essay-coach-instant/">

  <!-- Icons / PWA (optional but safe) -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#111111" />

  <!-- Fonts (optional) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=IBM+Plex+Serif:wght@400;600&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Scripts (order matters) -->
  <script defer src="js/i18n.js"></script>
  <script defer src="js/config.js"></script>

  <!-- EC bootstrap: API base + DEV flag (kept minimal) -->
  <script>
    window.EC = window.EC || {};
    if (!window.EC.API_BASE) {
      // Your live Worker or local dev can override this
      window.EC.API_BASE = 'https://essaycoach.alfons149.workers.dev/api';
    }
    if (typeof window.EC.DEV !== 'boolean') {
      const qs = new URLSearchParams(location.search);
      window.EC.DEV = (qs.get('dev') === '1');
    }
    console.log('[EC] API_BASE =', window.EC.API_BASE || '(mock)', 'DEV?', !!window.EC.DEV);
  </script>

  <script defer src="js/app.js"></script>

  <!-- First-load i18n boot (uses saved language; defaults to EN) -->
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const saved = localStorage.getItem('ec.lang') || 'en';
      document.documentElement.lang = saved;
      if (window.I18N && typeof I18N.load === 'function') {
        await I18N.load(saved);
      }
    });
  </script>

  <!-- Tiny debug guard (safe to keep) -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      if (typeof window.I18N === 'undefined') {
        console.error('[i18n] window.I18N is missing. Check js/i18n.js path/name.');
      }
    });
  </script>
</head>
<body>
  <noscript>This app requires JavaScript to run.</noscript>

  <!-- Top bar -->
  <header class="topbar">
    <div class="row" style="gap:8px; align-items:center;">
      <h1 class="app-title" data-i18n="app.name">EssayCoach</h1>
      <span class="spacer"></span>

      <!-- Language buttons with translated tooltips -->
      <button class="btn-ghost" data-lang="en" title="English"    data-i18n-title="tooltips.lang_en">EN</button>
      <button class="btn-ghost" data-lang="es" title="Español"    data-i18n-title="tooltips.lang_es">ES</button>
      <button class="btn-ghost" data-lang="nl" title="Nederlands" data-i18n-title="tooltips.lang_nl">NL</button>

      <!-- API/dev badges -->
      <span class="badge" id="apiMode" style="margin-left:8px"></span>
      <span class="badge" id="devBadge"  style="display:none">DEV</span>
    </div>
  </header>

  <main class="container">
    <h1 class="app-title" data-i18n="app.subtitle">EssayCoach – Cambridge Toolkit</h1>

    <!-- Level -->
    <section class="panel">
      <div class="row" style="gap:8px;">
        <strong data-i18n="labels.level">Level:</strong>
        <button class="pill" data-level="B2">B2</button>
        <button class="pill" data-level="C1">C1</button>
        <button class="pill" data-level="C2">C2</button>
      </div>
    </section>

    <!-- Inputs -->
    <section class="grid-2">
      <div class="card">
        <div class="card-title" data-i18n="labels.prompt">Task prompt</div>
        <!-- empty content so placeholder shows -->
        <textarea id="task" rows="6" data-i18n-ph="placeholders.task"></textarea>
      </div>

      <div class="card">
        <div class="card-title" data-i18n="labels.essay">Your essay</div>
        <!-- empty content so placeholder shows -->
        <textarea id="essay" rows="12" data-i18n-ph="placeholders.essay"></textarea>
      </div>
    </section>

    <!-- Toolbar -->
    <section class="toolbar row" style="gap:8px; align-items:center;">
      <button id="btnCorrect" class="btn-primary"
              data-i18n="buttons.correct"
              title="Correct the essay"
              data-i18n-title="tooltips.correct">Correct</button>

      <button id="btnClear" class="btn-ghost"
              data-i18n="buttons.clear"
              title="Clear all fields"
              data-i18n-title="tooltips.clear">Clear</button>

      <span class="spacer"></span>

      <!-- Word counters (text updated by app.js) -->
      <div id="inWC"  class="pill" data-i18n="io.input_words">Input: {n} words</div>
      <div id="outWC" class="pill" data-i18n="io.output_words">Output: {n} words</div>
    </section>

    <!-- Results -->
    <section class="grid-2">
      <div class="card">
        <div class="card-title" data-i18n="labels.feedback">Feedback</div>
        <div id="feedback" class="prose">—</div>
      </div>

      <div class="card">
        <div class="card-title" data-i18n="labels.edits">Edits</div>
        <ul id="edits" class="list"></ul>
      </div>
    </section>

    <!-- Next draft -->
    <section class="card">
      <div class="card-title" data-i18n="labels.next_draft">Next draft</div>
      <textarea id="nextDraft" rows="10" data-i18n-ph="placeholders.next_draft"></textarea>
    </section>

    <!-- Vocabulary (optional, shown by app.js when available) -->
    <section class="card" id="vocabCard" hidden>
      <div class="card-title" data-i18n="labels.vocab_options">Vocabulary options</div>
      <ul id="vocab" class="list"></ul>
    </section>
  </main>

  <!-- Language switch -->
  <script>
    document.addEventListener('click', async (e) => {
      const btn = e.target.closest('[data-lang]');
      if (!btn) return;
      const lang = btn.getAttribute('data-lang');
      try {
        localStorage.setItem('ec.lang', lang);
        document.documentElement.lang = lang;
        if (window.I18N && typeof I18N.load === 'function') {
          await I18N.load(lang);
        } else {
          location.reload();
        }
      } catch (err) {
        console.error('[lang switch]', err);
      }
    });
  </script>

  <!-- API/dev badges -->
  <script>
    (function () {
      const qs  = new URLSearchParams(location.search);
      const dev = qs.get('dev') === '1';
      const api = (window.EC && EC.API_BASE) ? 'live' : (dev ? 'mock' : 'auto');
      const apiEl = document.getElementById('apiMode');
      const devEl = document.getElementById('devBadge');
      if (apiEl) apiEl.textContent = api;
      if (devEl) devEl.style.display = dev ? 'inline' : 'none';
    })();
  </script>
</body>
</html>
